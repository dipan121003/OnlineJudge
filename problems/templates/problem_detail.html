<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ problem.title }} â€“ Online Judge</title>

  <!-- Bootstrap CSS -->

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Ace Editor -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.43.2/ace.js"></script>

</head>

<body class="bg-light">

  <div class="container py-5">

    <!-- Problem Header -->
    <div class="mb-4">
      <h1 class="display-5 fw-bold">{{ problem.title }}</h1>
      <p class="text-muted">
        Created: {{ problem.created_at|date:"F d, Y" }} |
        Difficulty:
        <span
          class="badge {% if problem.difficulty == 'Easy' %}bg-success{% elif problem.difficulty == 'Medium' %}bg-warning text-dark{% else %}bg-danger{% endif %}">
          {{ problem.difficulty }}
        </span>
      </p>
      <hr>
    </div>

    <!-- Problem Description -->
    <div class="card mb-5">
      <div class="card-body">
        <h5 class="card-title">Problem Description</h5>
        <p class="card-text" style="white-space: pre-line;">
          {{ problem.description }}
        </p>
      </div>
    </div>

    <!-- Editor Panel -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title mb-3">Write &amp; Run Your Code</h5>
        <form method="post" action="{% url 'run_code' %}">
          {% csrf_token %}
          <input type="hidden" name="problem" value="{{ problem.id }}">
          <div class="row g-3 mb-3">
            <div class="col-md-4">
              <label for="language" class="form-label">Language</label>
              <select id="language" name="language" class="form-select">
                <option value="python">Python</option>
                <option value="cpp">C++</option>
                <option value="java">Java</option>
              </select>
            </div>
          </div>
          <div class="mb-3">
            <label for="code-editor" class="form-label">Your Code</label>
            <div id="code-editor" style="height:400px; width:100%; border:1px solid #ccc; border-radius:4px;"></div>
            <textarea id="code" name="code" hidden></textarea>
          </div>
          <div class="d-flex gap-2 mb-3">
            <button type="submit" class="btn btn-secondary">Run Code</button>
            <button type="button" class="btn btn-primary">Submit Solution</button>
          </div>

          <!-- Shared I/O & Verdict Tabs -->
          <ul class="nav nav-tabs" id="ioTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="input-tab" data-bs-toggle="tab" data-bs-target="#input" type="button"
                role="tab">Input</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="output-tab" data-bs-toggle="tab" data-bs-target="#output" type="button"
                role="tab">Output</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="verdict-tab" data-bs-toggle="tab" data-bs-target="#verdict" type="button"
                role="tab">Verdict</button>
            </li>
          </ul>
          <div class="tab-content p-3 border border-top-0 rounded-bottom" id="ioTabContent">
            <div class="tab-pane fade show active" id="input" role="tabpanel">
              <textarea id="display-input" name="input_data" class="form-control font-monospace" rows="4"
                placeholder="Enter input here..."></textarea>
            </div>
            <div class="tab-pane fade" id="output" role="tabpanel">
              <textarea id="display-output" class="form-control font-monospace" rows="4" readonly
                placeholder="Output will appear here..."></textarea>
            </div>
            <div class="tab-pane fade" id="verdict" role="tabpanel">
              <textarea id="display-verdict" class="form-control font-monospace" rows="4" readonly
                placeholder="Verdict will appear here..."></textarea>
            </div>
          </div>
        </form>
      </div>
    </div>

  </div>

  <!-- Bootstrap JS -->

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Initialize Ace Editor -->

  <script>
    const editor = ace.edit("code-editor");
    editor.setOptions({
      mode: 'ace/mode/python',
      theme: 'ace/theme/monokai',
      fontSize: '14pt',
      showPrintMargin: false,
      wrap: true,
      useWorker: false,
      highlightActiveLine: true,
      readOnly: false
    });
    editor.session.setValue('');
    editor.focus();

    // Find the form that contains the editor
    const codeForm = editor.container.closest("form");
    
    // When the form is submitted, update the hidden textarea's value
    codeForm.addEventListener('submit', function() {
        const hiddenCodeInput = document.getElementById('code');
        hiddenCodeInput.value = editor.getValue();
    });

    // Switch language mode dynamically
    document.getElementById('language').addEventListener('change', function () {
      const lang = this.value;
      let mode = 'ace/mode/text';
      if (lang === 'python') mode = 'ace/mode/python';
      else if (lang === 'cpp') mode = 'ace/mode/c_cpp';
      else if (lang === 'java') mode = 'ace/mode/java';
      editor.session.setMode(mode);
    });
  </script>

</body>

</html>